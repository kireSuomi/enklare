<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <section>
      <input
        id="amount"
        placeholder="Please enter the amount of jokes you want to see (5-10)"
      />
      <select id="type">
        <option value="any">Any</option>
        <option value="single">Single</option>
        <option value="twopart">Twopart</option>
      </select>
      <button id="getJokes">Get jokes!</button>

      <div id="jokes"></div>
    </section>

    <script>
      const btnGetJokes = document.getElementById("getJokes");

      btnGetJokes.addEventListener("click", getJokes);

      function getJokeMarkupEl(joke) {
        const jokeDiv = document.createElement("div");

        console.log(joke);

        if (joke.type === "twopart") {
          jokeDiv.innerHTML = `
            <h3>${joke.type}</h3>
            <p>${joke.setup}</p>
            <p>${joke.delivery}</p>
          `;
        } else {
          jokeDiv.innerHTML = `
            <h3>${joke.type}</h3>
            <p>${joke.joke}</p>
          `;
        }

        jokeDiv.innerHTML = jokeDiv.innerHTML.replaceAll(
          /(\w*a\w*)/gi,
          '<span style="color: blue;">$1</span>'
        );
        return jokeDiv;
      }

      function printJokes(jokes) {
        const jokesDiv = document.getElementById("jokes");
        jokesDiv.innerHTML = "";

        jokes.forEach((joke) => {
          jokesDiv.appendChild(getJokeMarkupEl(joke));
        });
      }

      function getJokes() {
        const amount = document.getElementById("amount").value ?? undefined;
        const type = document.getElementById("type").value ?? undefined;

        console.log(amount, type);
        fetch(`/api/jokes?amount=${amount}&type=${type}`)
          .then((res) => {
            return res.json();
          })
          .then((data) => {
            if (data.error) {
              alert(data.error);
            } else {
              //Print the jokes and statistics
              console.log(data);
              printJokes(data);
            }
          });
      }
    </script>
  </body>
</html>
